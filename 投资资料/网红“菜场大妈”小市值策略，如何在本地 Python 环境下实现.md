ç½‘çº¢â€œèœåœºå¤§å¦ˆâ€å°å¸‚å€¼ç­–ç•¥ï¼Œå¦‚ä½•åœ¨æœ¬åœ° Python ç¯å¢ƒä¸‹å®ç°ï¼Ÿï¼ˆæœ¬åœ°Pythonä»£ç è§£æï¼‰

å‡ ä¹æ¯éš”ä¸€æ®µæ—¶é—´ï¼Œç½‘ä¸Šéƒ½ä¼šåˆ·åˆ°ä¸€ä¸ªç­–ç•¥ï¼š**â€œèœåœºå¤§å¦ˆâ€å°å¸‚å€¼ç­–ç•¥** ã€‚

ç­–ç•¥é€»è¾‘éå¸¸æœ´ç´ ï¼Œä½†å†å²è¡¨ç°å´å¾ˆäº®çœ¼ã€‚å› æ­¤ï¼Œè¯¥ç­–ç•¥æˆäº†å„ä¸ªè´¦å·åå¤æåŠçš„â€œæµé‡æ‹…å½“â€ã€‚

## âŒ ä¸€ä¸ªå¸¸è¢«å¿½ç•¥çš„é—®é¢˜

è¿™äº›æ¨æ–‡å†™çš„éƒ½éå¸¸å¥½ï¼Œå¯¹ç­–ç•¥åˆ†ææåº¦åˆ°ä½ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€ä¸ªå¯¹æœ¬åœ°Pythoné‡åŒ–æœ‰å¼ºè¿«ç—‡çš„äººæ¥è¯´ï¼Œæ€»è§‰å¾—æœ‰ç‚¹ä¸è¶³ï¼š

**è¿™äº›æ¨æ–‡çš„ç­–ç•¥å¤§å¤šæ˜¯åœ¨èšå®½ä¸Šå®ç°çš„ã€‚æœ‰çš„åšå¾—å¤šä¸€ç‚¹ï¼Œåœ¨QMTä¸Šä¹Ÿå®ç°äº†è¯¥ç­–ç•¥ã€‚** 

å› æ­¤ï¼Œç­–ç•¥çš„è¿è¡Œå’Œå›æµ‹ï¼Œå¾—ä¾èµ–è¿™äº›ç¬¬ä¸‰æ–¹å¹³å°ã€‚

![](https://pic2.zhimg.com/v2-77ecd1656d0f0c59cd951d5c7fdb322d_r.jpg)

![](https://pica.zhimg.com/v2-d9fc9cca446ab505ad4a6559ba0f0b92_r.jpg)




æˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨æœ¬åœ°Pythonç¯å¢ƒä¸‹å®ç°è¯¥ç­–ç•¥ï¼Ÿè¿™æ ·ï¼Œ**æˆ‘ä»¬å°±å¯ä»¥åœ¨è‡ªå·±çš„ç”µè„‘ä¸Šè‡ªç”±è¿è¡Œå’Œä¿®æ”¹ç­–ç•¥.** 

ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚

## ğŸ“Œ ç­–ç•¥æ ¸å¿ƒé€»è¾‘

è¿™ä¸ªç­–ç•¥æœ€æ—©æ¥è‡ªèšå®½ç¤¾åŒºï¼Œæœ¬è´¨å¹¶ä¸å¤æ‚ï¼Œå¯ä»¥æ¦‚æ‹¬ä¸ºä¸ƒä¸ªå­—ï¼š**è´¨å¥½ä»·ä½å¸‚å€¼å°** ã€‚

- **è´¨å¥½** ï¼š é€šå¸¸ç”¨ **è‚¡æ¯ç‡è¾ƒé«˜**  ä½œä¸ºåŸºæœ¬é¢ç­›é€‰æ¡ä»¶
- **ä»·ä½** ï¼š åªé€‰æ‹©è‚¡ä»·åœ¨ä¸€å®šåŒºé—´å†…çš„è‚¡ç¥¨ï¼Œæ¯”å¦‚ **1â€“9 å…ƒ**  ï¼ˆ1 å…ƒä»¥ä¸‹å®¹æ˜“è§¦å‘é€€å¸‚é£é™©ï¼Œéœ€å‰”é™¤ï¼‰
- **å¸‚å€¼å°** ï¼š åœ¨æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„è‚¡ç¥¨ä¸­ï¼Œä¼˜å…ˆé€‰æ‹©å°å¸‚å€¼æ ‡çš„

æ­¤å¤–ï¼Œè¿˜éœ€è¦ä¸€ç³»åˆ—å¸¸è§„è¿‡æ»¤æ¡ä»¶ï¼š

- å‰”é™¤ç§‘åˆ›æ¿ã€åŒ—äº¤æ‰€ã€æ–°ä¸‰æ¿è‚¡ç¥¨
- å‰”é™¤ ST / *ST
- å‰”é™¤åœç‰Œã€é€€å¸‚è‚¡ç¥¨
- å‰”é™¤å½“æ—¥æ¶¨åœã€è·Œåœè‚¡ç¥¨

å¬èµ·æ¥æ¡ä»¶ä¸å°‘ï¼Œä½†å¥½æ¶ˆæ¯æ˜¯ï¼š**è¿™äº›æ•°æ®åœ¨ Tushare é‡ŒåŸºæœ¬éƒ½èƒ½æ‹¿åˆ°** ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨æœ¬åœ°Pythonç¯å¢ƒä¸‹å®ç°è¿™ä¸ªç­–ç•¥ã€‚

```python3
# æ ¹æ®è‚¡æ¯ç‡å’Œå¸‚å€¼é€‰å–ä»Šå¤©è¯¥ä¹°çš„è‚¡ç¥¨
# ä¼ å…¥å‰ä¸€å¤©çš„åŸºæœ¬é¢æ•°æ®ï¼Œå› ä¸ºä»Šå¤©çš„é€‰è‚¡æ˜¯æ ¹æ®æ˜¨å¤©çš„åŸºæœ¬é¢æ•°æ®æ¥çš„
def stk_select(day, pre_day, bnd_frac = 0.25):

    df = pro.daily_basic(ts_code = '', trade_date = pre_day)  
    stock_list = df['ts_code'].tolist()

    # å‰”é™¤ä¸€äº›ä¸éœ€è¦æ¿å—çš„è‚¡ç¥¨ï¼š åˆ›ä¸šæ¿ã€ç§‘åˆ›æ¿ã€åŒ—äº¤æ‰€ã€ä¸‰æ¿
    stock_list = filter_stocks(stock_list)  
    df = df.set_index(['ts_code'])
    df = df.reindex(index=stock_list)
    
    # å°†è‚¡ç¥¨åˆ—è¡¨æŒ‰ç…§è‚¡æ¯ç‡ç”±é«˜åˆ°ä½çš„é¡ºåºæ’åˆ—
    df = df.sort_values(by='dv_ratio', ascending = False)
    # å–è‚¡æ¯ç‡æœ€é«˜çš„ä¸€éƒ¨åˆ†è‚¡ç¥¨ç”¨äºé€‰è‚¡
    df = df[:int(bnd_frac*len(df))]    
    # å°†è‚¡ç¥¨åˆ—è¡¨æŒ‰ç…§å¸‚å€¼ç”±ä½åˆ°é«˜çš„é¡ºåºæ’åˆ—
    df = df.sort_values(by='total_mv', ascending = True)
    stock_list = df.index.tolist()    
    
    # è¿‡æ»¤STã€åœç‰Œã€é€€å¸‚çš„è‚¡ç¥¨
    stock_list = filter_st_suspend_delist_stocks(stock_list, day)   
    # è¿‡æ»¤ä»Šå¤©æ¶¨åœã€è·Œåœçš„è‚¡ç¥¨  
    stock_list = filter_limitup_limitdown_stock(stock_list, day)
    # è¿‡æ»¤é«˜è‚¡ä»·è‚¡ç¥¨
    stock_list = filter_highprice_stock(stock_list, day)    
    assert len(stock_list) != 0, print('stock list length is 0')
    
    # ä¿å­˜ä»Šæ—¥é€‰è‚¡ç»“æœæ–‡ä»¶
    file_name_stk = 'data/æ¯æ—¥é€‰è‚¡/' + day + '_stks.pkl'
    with open(file_name_stk, 'wb') as file:
        pickle.dump(stock_list, file)    
    return stock_list
```

## ğŸ“Š  ä¸»è¦æ¨¡å—

### 1ï¸âƒ£ è‚¡æ¯ç‡ & å¸‚å€¼

å¯ç›´æ¥é€šè¿‡ Tushare çš„`pro.daily_basic()` æ¥å£è·å–ï¼š

```python3
df = pro.daily_basic(ts_code = "", trade_date = day)
```

### 2ï¸âƒ£ å‰”é™¤ç§‘åˆ› / åŒ—äº¤ / ä¸‰æ¿ / åˆ›ä¸šæ¿

å¯ä»¥é€šè¿‡è‚¡ç¥¨ä»£ç è§„åˆ™è¿›è¡Œè¿‡æ»¤ï¼š

```python3
# è¿‡æ»¤ç§‘åˆ›ã€åŒ—äº¤ã€ä¸‰æ¿ã€åˆ›ä¸šæ¿ç­‰æ¿å—è‚¡ç¥¨
# [1] ä¸‰æ¿ï¼š4å¼€å¤´
# [2] åŒ—äº¤ï¼š8å¼€å¤´
# [3] ç§‘åˆ›ï¼š688å¼€å¤´
# [4] åˆ›ä¸šæ¿ï¼š300 / 301 å¼€å¤´
def filter_stocks(stock_list):
    for stock in stock_list[:]:
        if stock[0] == '4' or stock[0] == '8' or stock[:3] == '688' or \
           stock[:3] == '300' or stock[:3] == '301':
            stock_list.remove(stock)
    return stock_list
```

### 3ï¸âƒ£ å‰”é™¤åœç‰Œè‚¡ç¥¨

Tushare å¯é€šè¿‡ `pro.suspend_d()` è·å–æŸæ—¥åœç‰Œä¿¡æ¯ï¼š

```python3
stk_suspend = pro.suspend_d(suspend_type='S',trade_date=day)
```

### 4ï¸âƒ£ å‰”é™¤ ST / *ST è‚¡ç¥¨

Tushare æ²¡æœ‰ç›´æ¥ç»™STçŠ¶æ€ï¼Œä½†å¯ä»¥é€šè¿‡**è‚¡ç¥¨åç§°å˜æ›´è®°å½•** æ¥åæ¨ï¼Œä¸»è¦ç”¨åˆ°çš„æ˜¯`pro.namechange()`æ¥å£ï¼š

```python3
# è·å–æ¯æ—¥çš„STã€*STè‚¡ç¥¨åˆ—è¡¨
def get_st(trade_date):
    # è·å–ä¸‰å¹´å‰æ—¥æœŸï¼Œå› ä¸ºSTæœ€å¤š3å¹´
    start_date = (datetime.datetime.strptime(trade_date,'%Y%m%d') - \
                datetime.timedelta(days=365*3)).strftime('%Y%m%d')
    # è·å–ä¸‰å¹´å†…æ‰€æœ‰æ›´åè®°å½•
    df = pro.namechange(start_date=start_date,end_date=trade_date, \
                        fields='ts_code,name,start_date,end_date,ann_date,change_reason')
    # ç­›é€‰æ›´ååŸå› ä¸ºSTæˆ–*STçš„è®°å½•ï¼Œå»æ‰ç»“æŸæ—¥æœŸé‡å¤ä¸ºNoneçš„
    df = df[(df['change_reason']=='ST') | (df['change_reason']=='*ST')] \
        .sort_values(by='end_date',ascending=True).drop_duplicates(subset=['ts_code','start_date'],keep='first')
    # ç­›é€‰ç›®æ ‡æ—¥æœŸåœ¨STæ—¶é—´æ®µçš„è®°å½•
    result = df[(df.start_date<=trade_date)&((df.end_date>=trade_date)|(df.end_date.isna()))]
    return result
```

### 5ï¸âƒ£ å‰”é™¤é€€å¸‚è‚¡ç¥¨

è¿™é‡Œæœ‰ä¸¤ç§å®ç°æ€è·¯ã€‚

**æ–¹å¼ä¸€ï¼šè‚¡ç¥¨åç§°ä¸­æ˜¯å¦åŒ…å«â€œé€€â€å­—** 

```python3
def filter_delist(stock_list, day):
    stock_names = get_stock_chinese_name(stock_list, day)
    stock_list = [
        code for code, name in zip(stock_list, stock_names)
        if 'é€€' not in name
    ]
    return stock_list
```

**æ–¹å¼äºŒï¼šæˆäº¤é‡ä¸º 0ï¼ˆç®€å•ç²—æš´ï¼Œä½†ä¸ä¸€å®šæ˜¯é€€å¸‚å¯¼è‡´ï¼‰** 

```python3
def filter_delist(stock_list, day):
    temp = pro.daily(trade_date=day)
    temp = temp.set_index('ts_code').reindex(stock_list)
    temp = temp[temp['vol'] == 0]
    return [stk for stk in stock_list if stk not in temp.index]
```

### 6ï¸âƒ£ å‰”é™¤æ¶¨åœ / è·Œåœè‚¡ç¥¨

é€šè¿‡ `pro.stk_limit()` è·å–æ¶¨è·Œåœä»·ï¼Œå¯¹æ¯”å½“æ—¥æ”¶ç›˜ä»·å³å¯ï¼š

```python3
def filter_limitup_limitdown_stock(stock_list, trade_date):
    df_price = pro.daily(trade_date=trade_date).set_index('ts_code')
    df_limit = pro.stk_limit(trade_date=trade_date).set_index('ts_code')
    df_limit = df_limit.reindex(df_price.index)

    limit_stocks = [
        stk for stk in df_price.index
        if df_price.loc[stk, 'close'] == df_limit.loc[stk, 'up_limit']
        or df_price.loc[stk, 'close'] == df_limit.loc[stk, 'down_limit']
    ]

    return [stk for stk in stock_list if stk not in limit_stocks]
```

## ğŸš€ æœ¬åœ°å›æµ‹

åˆ°è¿™é‡Œï¼Œ**é€‰è‚¡é€»è¾‘å·²ç»å®Œæ•´é—­ç¯** ã€‚æ¥ä¸‹æ¥è¦åšçš„ï¼Œå°±æ˜¯ï¼š

- å°†ä¸Šè¿°ç­›é€‰æµç¨‹æ¨¡å—åŒ–
- ç”Ÿæˆæ¯æ—¥é€‰è‚¡ç»“æœ
- åŸºäºæœ¬åœ°æ•°æ®
- ä½¿ç”¨ **Backtrader**  å¯¹ç­–ç•¥è¿›è¡Œå›æµ‹

![](https://pic4.zhimg.com/v2-db4787e542c2e0a9d782e9176476a43d_r.jpg)

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ï¼šå®Œå…¨è„±ç¦»ç¬¬ä¸‰æ–¹å¹³å°ï¼Œè‡ªç”±ä¿®æ”¹ç­–ç•¥é€»è¾‘ï¼Œä»»æ„ç»„åˆå› å­ï¼Œæ„å»ºå±äºè‡ªå·±çš„æœ¬åœ°é‡åŒ–ä½“ç³»ã€‚



---

## è¯„è®º

å…± 7 æ¡è¯„è®ºï¼Œå·²å­˜ 7 æ¡

### ç§‹æ°´12345

æ•°æ®ç”¨å“ªä¸ªå‘¢ï¼Ÿæ•°æ®è¦æ”¶è´¹å§

2026-01-19 ä¸Šæµ· 1 èµ

> #### Pythonæœ¬åœ°é‡åŒ–
> 
> Tushare 
> 
> 2026-01-19 å¹¿ä¸œ 0 èµ

### æ™¨æ—­å®å®

å†™çš„çœŸä¸é”™åŠ æ²¹åŠ æ²¹[èµåŒ]

2026-01-19 æ²³å— 0 èµ

> #### Pythonæœ¬åœ°é‡åŒ–
> 
> è°¢è°¢ï¼
> 
> 2026-01-19 å¹¿ä¸œ 0 èµ

### ç§‹æ°´12345

æ˜¯éœ€è¦æ”¶è´¹ç‰ˆçš„å—ï¼Ÿå…è´¹ç‰ˆçš„æä¾›ä¸äº†è¿™ä¹ˆå…¨é¢çš„æ•°æ®å§

2026-01-19 ä¸Šæµ· 0 èµ

> #### Pythonæœ¬åœ°é‡åŒ–
> 
> 2000ç§¯åˆ†çš„å°±å¯ä»¥ï¼Œç¨³å¦¥ç‚¹çš„è¯æœ€å¥½5000ç§¯åˆ†ä»¥ä¸Šã€‚æé‡åŒ–ï¼Œè¿˜æ˜¯å¾—èŠ±ç‚¹é’±å§
> 
> 2026-01-19 å¹¿ä¸œ 0 èµ
> 
> #### ç§‹æ°´12345 â€º Pythonæœ¬åœ°é‡åŒ–
> 
> äº†è§£äº†ï¼Œå¤šè°¢ä¸åèµæ•™[æ¡æ‰‹]
> 
> 2026-01-19 ä¸Šæµ· 0 èµ
